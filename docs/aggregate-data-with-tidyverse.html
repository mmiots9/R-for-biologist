<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13 Aggregate data with tidyverse | Learn R for biologist</title>
  <meta name="description" content="This course is for biologists who want to optimize their analysis, making them faster and reproducible." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="13 Aggregate data with tidyverse | Learn R for biologist" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This course is for biologists who want to optimize their analysis, making them faster and reproducible." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Aggregate data with tidyverse | Learn R for biologist" />
  
  <meta name="twitter:description" content="This course is for biologists who want to optimize their analysis, making them faster and reproducible." />
  

<meta name="author" content="Matteo Miotto" />


<meta name="date" content="2025-01-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tidyverse-manage.html"/>
<link rel="next" href="plot-our-data-with-ggplot2.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<meta property="og:description" content="To you, who never gives up, for your future. You can make it!">
<meta name="keywords" content="R, biology, data analysis">
<meta name="author" content="Matteo Miotto">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YDEBEF61BH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YDEBEF61BH');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for biologist</a></li>
<li class="divider"></li>
<li><a href="index.html#about" id="toc-about">About</a></li>
<li><a href="installation.html#installation" id="toc-installation"><span class="toc-section-number">1</span> Installation</a></li>
<li><a href="first-step-in-rstudio.html#first-step-in-rstudio" id="toc-first-step-in-rstudio"><span class="toc-section-number">2</span> First step in RStudio</a>
<ul>
<li><a href="first-step-in-rstudio.html#console" id="toc-console">Console</a></li>
</ul></li>
<li><a href="variables.html#variables" id="toc-variables"><span class="toc-section-number">3</span> Variables</a>
<ul>
<li><a href="variables.html#create-a-variable" id="toc-create-a-variable">Create a variable</a></li>
<li><a href="variables.html#use-a-variable" id="toc-use-a-variable">Use a variable</a></li>
<li><a href="variables.html#variable-names" id="toc-variable-names">Variable names</a></li>
<li><a href="variables.html#overwriting-variables" id="toc-overwriting-variables">Overwriting variables</a></li>
<li><a href="variables.html#list-all-variables" id="toc-list-all-variables">List all variables</a></li>
<li><a href="variables.html#delete-variables" id="toc-delete-variables">Delete variables</a></li>
<li><a href="variables.html#type-of-variables" id="toc-type-of-variables">Type of variables</a></li>
<li><a href="variables.html#exercises" id="toc-exercises">Exercises</a></li>
</ul></li>
<li><a href="scripts-chapter.html#scripts-chapter" id="toc-scripts-chapter"><span class="toc-section-number">4</span> Scripts</a>
<ul>
<li><a href="scripts-chapter.html#save" id="toc-save">Save</a></li>
<li><a href="scripts-chapter.html#source-a-script" id="toc-source-a-script">Source a script</a></li>
</ul></li>
<li><a href="numbers.html#numbers" id="toc-numbers"><span class="toc-section-number">5</span> Numbers</a>
<ul>
<li><a href="numbers.html#operations" id="toc-operations">Operations</a></li>
<li><a href="numbers.html#rounding" id="toc-rounding">Rounding</a></li>
<li><a href="numbers.html#tranform-to-type-number" id="toc-tranform-to-type-number">Tranform to type number</a></li>
<li><a href="numbers.html#exercises-1" id="toc-exercises-1">Exercises</a></li>
</ul></li>
<li><a href="character.html#character" id="toc-character"><span class="toc-section-number">6</span> Character</a>
<ul>
<li><a href="character.html#concatenate-strings" id="toc-concatenate-strings">Concatenate strings</a></li>
<li><a href="character.html#substring" id="toc-substring">Substring</a></li>
<li><a href="character.html#substitution" id="toc-substitution">Substitution</a></li>
<li><a href="character.html#grep" id="toc-grep">Grep</a></li>
<li><a href="character.html#transform-to-type-character" id="toc-transform-to-type-character">Transform to type character</a></li>
<li><a href="character.html#exercises-2" id="toc-exercises-2">Exercises</a></li>
</ul></li>
<li><a href="boolean-chapter.html#boolean-chapter" id="toc-boolean-chapter"><span class="toc-section-number">7</span> Boolean</a>
<ul>
<li><a href="boolean-chapter.html#boolean-as-results-of-comparison" id="toc-boolean-as-results-of-comparison">Boolean as results of comparison</a></li>
<li><a href="boolean-chapter.html#logical-operator" id="toc-logical-operator">Logical operator</a>
<ul>
<li><a href="boolean-chapter.html#and" id="toc-and">AND</a></li>
<li><a href="boolean-chapter.html#or" id="toc-or">OR</a></li>
<li><a href="boolean-chapter.html#not" id="toc-not">NOT</a></li>
</ul></li>
<li><a href="boolean-chapter.html#exercises-3" id="toc-exercises-3">Exercises</a></li>
</ul></li>
<li><a href="vectors.html#vectors" id="toc-vectors"><span class="toc-section-number">8</span> Vectors</a>
<ul>
<li><a href="vectors.html#named-vectors" id="toc-named-vectors">Named vectors</a></li>
<li><a href="vectors.html#indexing" id="toc-indexing">Indexing</a>
<ul>
<li><a href="vectors.html#named-vectors-1" id="toc-named-vectors-1">Named vectors</a></li>
<li><a href="vectors.html#slicing-vectors" id="toc-slicing-vectors">Slicing</a></li>
<li><a href="vectors.html#using-logicals" id="toc-using-logicals">Using logicals</a></li>
</ul></li>
<li><a href="vectors.html#one-function-can-be-applied-to-all-elements" id="toc-one-function-can-be-applied-to-all-elements">One function can be applied to all elements</a></li>
<li><a href="vectors.html#functions-specific-of-vectors" id="toc-functions-specific-of-vectors">Functions specific of vectors</a>
<ul>
<li><a href="vectors.html#sorting-a-vector" id="toc-sorting-a-vector">Sorting a vector</a></li>
<li><a href="vectors.html#unique-values" id="toc-unique-values">Unique values</a></li>
<li><a href="vectors.html#logical-vectors-sum-and-mean" id="toc-logical-vectors-sum-and-mean">Logical vectors sum and mean</a></li>
</ul></li>
<li><a href="vectors.html#operations-between-vectors" id="toc-operations-between-vectors">Operations between vectors</a>
<ul>
<li><a href="vectors.html#mathematical" id="toc-mathematical">Mathematical</a></li>
<li><a href="vectors.html#different-and-common-elements" id="toc-different-and-common-elements">Different and common elements</a></li>
<li><a href="vectors.html#in" id="toc-in">%in%</a></li>
<li><a href="vectors.html#match" id="toc-match">Match</a></li>
</ul></li>
<li><a href="vectors.html#exercises-4" id="toc-exercises-4">Exercises</a></li>
</ul></li>
<li><a href="matrices.html#matrices" id="toc-matrices"><span class="toc-section-number">9</span> Matrices</a>
<ul>
<li><a href="matrices.html#create-a-matrix" id="toc-create-a-matrix">Create a matrix</a>
<ul>
<li><a href="matrices.html#binding" id="toc-binding">Binding</a></li>
<li><a href="matrices.html#transform-into-a-matrix" id="toc-transform-into-a-matrix">Transform into a matrix</a></li>
</ul></li>
<li><a href="matrices.html#rownames-and-colnames" id="toc-rownames-and-colnames">Rownames and colnames</a>
<ul>
<li><a href="matrices.html#set-and-edit-row-and-column-names" id="toc-set-and-edit-row-and-column-names">Set and edit row and column names</a></li>
</ul></li>
<li><a href="matrices.html#indexing-matrices" id="toc-indexing-matrices">Indexing</a>
<ul>
<li><a href="matrices.html#slicing" id="toc-slicing">Slicing</a></li>
<li><a href="matrices.html#using-names" id="toc-using-names">Using names</a></li>
<li><a href="matrices.html#using-logicals-1" id="toc-using-logicals-1">Using logicals</a></li>
</ul></li>
<li><a href="matrices.html#functions-for-all-matrix" id="toc-functions-for-all-matrix">Functions for all matrix</a>
<ul>
<li><a href="matrices.html#head-tail-matrices" id="toc-head-tail-matrices">Head/Tail</a></li>
<li><a href="matrices.html#dim-nrow-ncol" id="toc-dim-nrow-ncol">Dim, nrow, ncol</a></li>
<li><a href="matrices.html#summary-and-transpose" id="toc-summary-and-transpose">Summary and transpose</a></li>
<li><a href="matrices.html#sum-max-min" id="toc-sum-max-min">Sum, Max, Min, …</a></li>
</ul></li>
<li><a href="matrices.html#apply-a-function-to-all-rows-or-columns" id="toc-apply-a-function-to-all-rows-or-columns">Apply a function to all rows or columns</a></li>
<li><a href="matrices.html#exercises-5" id="toc-exercises-5">Exercises</a></li>
</ul></li>
<li><a href="data-frames.html#data-frames" id="toc-data-frames"><span class="toc-section-number">10</span> Data frames</a>
<ul>
<li><a href="data-frames.html#create-a-data.frame" id="toc-create-a-data.frame">Create a data.frame</a>
<ul>
<li><a href="data-frames.html#from-matrix" id="toc-from-matrix">From matrix</a></li>
<li><a href="data-frames.html#from-vectors" id="toc-from-vectors">From vectors</a></li>
<li><a href="data-frames.html#from-file" id="toc-from-file">From file</a></li>
</ul></li>
<li><a href="data-frames.html#indexing-1" id="toc-indexing-1">Indexing</a></li>
<li><a href="data-frames.html#create-a-new-column" id="toc-create-a-new-column">Create a new column</a></li>
<li><a href="data-frames.html#delete-a-column" id="toc-delete-a-column">Delete a column</a></li>
<li><a href="data-frames.html#export-a-data-frame" id="toc-export-a-data-frame">Export a data frame</a></li>
</ul></li>
<li><a href="functions-packages-and-reproducibility.html#functions-packages-and-reproducibility" id="toc-functions-packages-and-reproducibility"><span class="toc-section-number">11</span> Functions, packages and reproducibility</a>
<ul>
<li><a href="functions-packages-and-reproducibility.html#functions" id="toc-functions">Functions</a></li>
<li><a href="functions-packages-and-reproducibility.html#packages" id="toc-packages">Packages</a>
<ul>
<li><a href="functions-packages-and-reproducibility.html#install-a-package" id="toc-install-a-package">Install a package</a></li>
<li><a href="functions-packages-and-reproducibility.html#load-a-package" id="toc-load-a-package">Load a package</a></li>
</ul></li>
<li><a href="functions-packages-and-reproducibility.html#reproducibility" id="toc-reproducibility">Reproducibility</a>
<ul>
<li><a href="functions-packages-and-reproducibility.html#control-package-versions" id="toc-control-package-versions">Control package versions</a></li>
<li><a href="functions-packages-and-reproducibility.html#session-info" id="toc-session-info">Session info</a></li>
</ul></li>
</ul></li>
<li><a href="tidyverse-manage.html#tidyverse-manage" id="toc-tidyverse-manage"><span class="toc-section-number">12</span> Manage data with tidyverse</a>
<ul>
<li><a href="tidyverse-manage.html#r-notebook" id="toc-r-notebook">R notebook</a></li>
<li><a href="tidyverse-manage.html#load-packages-and-data" id="toc-load-packages-and-data">Load packages and data</a></li>
<li><a href="tidyverse-manage.html#dataset-structure" id="toc-dataset-structure">Dataset structure</a>
<ul>
<li><a href="tidyverse-manage.html#change-column-type" id="toc-change-column-type">Change column type</a></li>
<li><a href="tidyverse-manage.html#reorder-levels-of-a-factor" id="toc-reorder-levels-of-a-factor">Reorder levels of a factor</a></li>
</ul></li>
<li><a href="tidyverse-manage.html#summary" id="toc-summary">Summary</a></li>
<li><a href="tidyverse-manage.html#dealing-with-missing-values" id="toc-dealing-with-missing-values">Dealing with missing values</a></li>
<li><a href="tidyverse-manage.html#filter-a-dataframe" id="toc-filter-a-dataframe">Filter a dataframe</a></li>
<li><a href="tidyverse-manage.html#sort-for-the-value-of-a-column" id="toc-sort-for-the-value-of-a-column">Sort for the value of a column</a></li>
<li><a href="tidyverse-manage.html#merge-two-columns" id="toc-merge-two-columns">Merge two columns</a></li>
<li><a href="tidyverse-manage.html#split-two-columns" id="toc-split-two-columns">Split two columns</a></li>
<li><a href="tidyverse-manage.html#merge-two-dataframes" id="toc-merge-two-dataframes">Merge two dataframes</a></li>
<li><a href="tidyverse-manage.html#exercises-6" id="toc-exercises-6">Exercises</a></li>
</ul></li>
<li><a href="aggregate-data-with-tidyverse.html#aggregate-data-with-tidyverse" id="toc-aggregate-data-with-tidyverse"><span class="toc-section-number">13</span> Aggregate data with tidyverse</a>
<ul>
<li><a href="aggregate-data-with-tidyverse.html#table" id="toc-table">Table</a></li>
<li><a href="aggregate-data-with-tidyverse.html#group-by-variables-and-summarize-values-of-another" id="toc-group-by-variables-and-summarize-values-of-another">Group by variables and summarize values of another</a></li>
<li><a href="aggregate-data-with-tidyverse.html#expand-dataframe-column-using-pivot-wider" id="toc-expand-dataframe-column-using-pivot-wider">Expand dataframe column using pivot wider</a></li>
<li><a href="aggregate-data-with-tidyverse.html#reshape-a-dataframe-with-pivot_longer" id="toc-reshape-a-dataframe-with-pivot_longer">Reshape a dataframe with pivot_longer</a></li>
<li><a href="aggregate-data-with-tidyverse.html#exercises-7" id="toc-exercises-7">Exercises</a></li>
</ul></li>
<li><a href="plot-our-data-with-ggplot2.html#plot-our-data-with-ggplot2" id="toc-plot-our-data-with-ggplot2"><span class="toc-section-number">14</span> Plot our data with ggplot2</a>
<ul>
<li><a href="plot-our-data-with-ggplot2.html#command-structure" id="toc-command-structure">Command structure</a></li>
<li><a href="plot-our-data-with-ggplot2.html#type-of-graph-geom_-and-stat_" id="toc-type-of-graph-geom_-and-stat_">Type of graph (geom_ and stat_)</a>
<ul>
<li><a href="plot-our-data-with-ggplot2.html#mapping-values-to-graph-elements-aes" id="toc-mapping-values-to-graph-elements-aes">Mapping values to graph elements (aes)</a></li>
<li><a href="plot-our-data-with-ggplot2.html#change-the-stat-associated-to-the-graph" id="toc-change-the-stat-associated-to-the-graph">Change the “stat” associated to the graph</a></li>
<li><a href="plot-our-data-with-ggplot2.html#multiple-geometries-in-the-same-plot" id="toc-multiple-geometries-in-the-same-plot">Multiple geometries in the same plot</a></li>
</ul></li>
<li><a href="plot-our-data-with-ggplot2.html#change-axis-and-colors-scale_" id="toc-change-axis-and-colors-scale_">Change axis and colors (scale_)</a></li>
<li><a href="plot-our-data-with-ggplot2.html#add-title-and-change-labels-labs" id="toc-add-title-and-change-labels-labs">Add title and change labels (labs)</a></li>
<li><a href="plot-our-data-with-ggplot2.html#change-appearence-theme" id="toc-change-appearence-theme">Change appearence (theme)</a></li>
<li><a href="plot-our-data-with-ggplot2.html#save-plot" id="toc-save-plot">Save plot</a></li>
</ul></li>
<li><a href="intro-stat-chapter.html#intro-stat-chapter" id="toc-intro-stat-chapter"><span class="toc-section-number">15</span> Introduction to statistics in R</a>
<ul>
<li><a href="intro-stat-chapter.html#evaluate-parametric-assumptions" id="toc-evaluate-parametric-assumptions">Evaluate parametric assumptions</a>
<ul>
<li><a href="intro-stat-chapter.html#visual-inspection" id="toc-visual-inspection">Visual inspection</a></li>
<li><a href="intro-stat-chapter.html#no-outliers" id="toc-no-outliers">No outliers</a></li>
<li><a href="intro-stat-chapter.html#normality" id="toc-normality">Normality</a>
<ul>
<li><a href="intro-stat-chapter.html#shapiro-wilk-normality-test" id="toc-shapiro-wilk-normality-test">Shapiro-Wilk normality test</a></li>
<li><a href="intro-stat-chapter.html#kolmogorov-smirnov-test" id="toc-kolmogorov-smirnov-test">Kolmogorov-Smirnov test</a></li>
</ul></li>
<li><a href="intro-stat-chapter.html#homogeneity-of-variances-homoschedaticity" id="toc-homogeneity-of-variances-homoschedaticity">Homogeneity of variances (homoschedaticity)</a></li>
</ul></li>
</ul></li>
<li><a href="association-between-categorical-variables.html#association-between-categorical-variables" id="toc-association-between-categorical-variables"><span class="toc-section-number">16</span> Association between categorical variables</a>
<ul>
<li><a href="association-between-categorical-variables.html#fisher-exact-test" id="toc-fisher-exact-test">Fisher exact test</a>
<ul>
<li><a href="association-between-categorical-variables.html#phi-φ-coefficient" id="toc-phi-φ-coefficient">Phi (φ) Coefficient</a></li>
</ul></li>
<li><a href="association-between-categorical-variables.html#chi-squared-test-with-yates-correction" id="toc-chi-squared-test-with-yates-correction">Chi-Squared test with Yates correction</a></li>
<li><a href="association-between-categorical-variables.html#chi-squared-test-without-correction" id="toc-chi-squared-test-without-correction">Chi-Squared test without correction</a>
<ul>
<li><a href="association-between-categorical-variables.html#cramers-v" id="toc-cramers-v">Cramer’s V</a></li>
</ul></li>
</ul></li>
<li><a href="comparing-two-groups.html#comparing-two-groups" id="toc-comparing-two-groups"><span class="toc-section-number">17</span> Comparing two groups</a>
<ul>
<li><a href="comparing-two-groups.html#t-test" id="toc-t-test">T-test</a></li>
<li><a href="comparing-two-groups.html#welchs-test" id="toc-welchs-test">Welch’s test</a></li>
<li><a href="comparing-two-groups.html#mann-whitney-and-wilcoxon" id="toc-mann-whitney-and-wilcoxon">Mann-Whitney and Wilcoxon</a></li>
<li><a href="comparing-two-groups.html#add-values-to-graph" id="toc-add-values-to-graph">Add values to graph</a></li>
</ul></li>
<li><a href="comparing-more-groups.html#comparing-more-groups" id="toc-comparing-more-groups"><span class="toc-section-number">18</span> Comparing more groups</a>
<ul>
<li><a href="comparing-more-groups.html#anova" id="toc-anova">ANOVA</a>
<ul>
<li><a href="comparing-more-groups.html#post-hoc-test" id="toc-post-hoc-test">Post-hoc test</a></li>
</ul></li>
<li><a href="comparing-more-groups.html#kruskal-wallis" id="toc-kruskal-wallis">Kruskal Wallis</a>
<ul>
<li><a href="comparing-more-groups.html#post-hoc-test-1" id="toc-post-hoc-test-1">Post-hoc test</a></li>
</ul></li>
</ul></li>
<li><a href="correlation.html#correlation" id="toc-correlation"><span class="toc-section-number">19</span> Correlation</a>
<ul>
<li><a href="correlation.html#pearsons-test" id="toc-pearsons-test">Pearson’s test</a></li>
</ul></li>
<li><a href="farewell.html#farewell" id="toc-farewell"><span class="toc-section-number">20</span> Farewell</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Learn R for biologist</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="aggregate-data-with-tidyverse" class="section level1" number="13">
<h1><span class="header-section-number">13</span> Aggregate data with tidyverse</h1>
<p>After having seen how to organize and manipulate a dataframe, let’s start analyzing them! In particular, in this chapter we will see how to aggregate data based on values of one or more columns.</p>
<p>The first step, as always, is to load the packages and the data:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="aggregate-data-with-tidyverse.html#cb403-1" tabindex="-1"></a><span class="co"># 1. Load packages </span></span>
<span id="cb403-2"><a href="aggregate-data-with-tidyverse.html#cb403-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb403-3"><a href="aggregate-data-with-tidyverse.html#cb403-3" tabindex="-1"></a></span>
<span id="cb403-4"><a href="aggregate-data-with-tidyverse.html#cb403-4" tabindex="-1"></a><span class="co"># 2. Load data</span></span>
<span id="cb403-5"><a href="aggregate-data-with-tidyverse.html#cb403-5" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/Supplementary_table_13.csv&quot;</span>)</span>
<span id="cb403-6"><a href="aggregate-data-with-tidyverse.html#cb403-6" tabindex="-1"></a><span class="fu">head</span>(df)</span></code></pre></div>
<pre class="code-out"><code>  SampleID Diagnosis Braak sex AOD PMI RIN CDR Area dataset
1 1005_TCX        AD     6   F  90   8 8.6  NA   TL    MAYO
2 1019_TCX        AD     6   F  86   4 7.8  NA   TL    MAYO
3 1029_TCX        AD     6   F  69   4 9.7  NA   TL    MAYO
4 1034_TCX        AD     6   F  88   5 8.9  NA   TL    MAYO
5 1045_TCX        AD     5   F  90  NA 8.4  NA   TL    MAYO
6 1046_TCX        AD     6   F  72   2 9.0  NA   TL    MAYO</code></pre>
<p>Then, we will change the column types (as in last chapter):</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="aggregate-data-with-tidyverse.html#cb405-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb405-2"><a href="aggregate-data-with-tidyverse.html#cb405-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;Diagnosis&quot;</span> <span class="ot">=</span> <span class="fu">factor</span>(Diagnosis, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;AD&quot;</span>)),</span>
<span id="cb405-3"><a href="aggregate-data-with-tidyverse.html#cb405-3" tabindex="-1"></a>         <span class="st">&quot;sex&quot;</span> <span class="ot">=</span> <span class="fu">factor</span>(sex),</span>
<span id="cb405-4"><a href="aggregate-data-with-tidyverse.html#cb405-4" tabindex="-1"></a>         <span class="st">&quot;Area&quot;</span> <span class="ot">=</span> <span class="fu">factor</span>(Area),</span>
<span id="cb405-5"><a href="aggregate-data-with-tidyverse.html#cb405-5" tabindex="-1"></a>         <span class="st">&quot;dataset&quot;</span> <span class="ot">=</span> <span class="fu">factor</span>(dataset))</span>
<span id="cb405-6"><a href="aggregate-data-with-tidyverse.html#cb405-6" tabindex="-1"></a></span>
<span id="cb405-7"><a href="aggregate-data-with-tidyverse.html#cb405-7" tabindex="-1"></a><span class="fu">str</span>(df)</span></code></pre></div>
<pre class="code-out"><code>&#39;data.frame&#39;:   1493 obs. of  10 variables:
 $ SampleID : chr  &quot;1005_TCX&quot; &quot;1019_TCX&quot; &quot;1029_TCX&quot; &quot;1034_TCX&quot; ...
 $ Diagnosis: Factor w/ 2 levels &quot;Control&quot;,&quot;AD&quot;: 2 2 2 2 2 2 2 2 2 2 ...
 $ Braak    : num  6 6 6 6 5 6 5.5 6 6 5 ...
 $ sex      : Factor w/ 2 levels &quot;F&quot;,&quot;M&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ AOD      : num  90 86 69 88 90 72 85 82 77 90 ...
 $ PMI      : num  8 4 4 5 NA 2 NA 15 NA NA ...
 $ RIN      : num  8.6 7.8 9.7 8.9 8.4 9 8 10 8.6 7.9 ...
 $ CDR      : num  NA NA NA NA NA NA NA NA NA NA ...
 $ Area     : Factor w/ 6 levels &quot;BM10&quot;,&quot;BM22&quot;,..: 6 6 6 6 6 6 6 6 6 6 ...
 $ dataset  : Factor w/ 3 levels &quot;MAYO&quot;,&quot;MSBB&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>We are now ready to start our very first analyses!</p>
<div id="table" class="section level2 unnumbered">
<h2>Table</h2>
<p>The very first function we will explore is <code>table</code>. It is used on vectors or dataframe columns and it returns the numerosity of each different value of them; when used for 2 vectors/columns, it returns a contingency matrix.
<br>
Let’s see:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="aggregate-data-with-tidyverse.html#cb407-1" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>sex)</span></code></pre></div>
<pre class="code-out"><code>
  F   M 
890 603 </code></pre>
<p>This is the simplest situation, it is not used so much (remember, summary does the same); but, it can be useful if combined with <code>sum</code> to get the fraction of each value. In fact, dividing the table for its sum, we can get the fraction of each value:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="aggregate-data-with-tidyverse.html#cb409-1" tabindex="-1"></a><span class="co"># 1. Create the table</span></span>
<span id="cb409-2"><a href="aggregate-data-with-tidyverse.html#cb409-2" tabindex="-1"></a>tbl_sex <span class="ot">&lt;-</span> <span class="fu">table</span>(df<span class="sc">$</span>sex)</span>
<span id="cb409-3"><a href="aggregate-data-with-tidyverse.html#cb409-3" tabindex="-1"></a></span>
<span id="cb409-4"><a href="aggregate-data-with-tidyverse.html#cb409-4" tabindex="-1"></a><span class="co"># 2. Calculate the sum of the table</span></span>
<span id="cb409-5"><a href="aggregate-data-with-tidyverse.html#cb409-5" tabindex="-1"></a>sum_tbl_sex <span class="ot">&lt;-</span> <span class="fu">sum</span>(tbl_sex)</span>
<span id="cb409-6"><a href="aggregate-data-with-tidyverse.html#cb409-6" tabindex="-1"></a></span>
<span id="cb409-7"><a href="aggregate-data-with-tidyverse.html#cb409-7" tabindex="-1"></a><span class="co"># 3. Calculate the fraction</span></span>
<span id="cb409-8"><a href="aggregate-data-with-tidyverse.html#cb409-8" tabindex="-1"></a>tbl_sex <span class="sc">/</span> sum_tbl_sex</span></code></pre></div>
<pre class="code-out"><code>
        F         M 
0.5961152 0.4038848 </code></pre>
<p>So, ~ 60% of samples comes from females and ~ 40% from males. Yes, we could have just written <code>table(df$sex)/sum(table(df$sex))</code>, one line, less stored variables.
<br>
We can do the same with two columns, and you will find doing it a lot during your analysis:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="aggregate-data-with-tidyverse.html#cb411-1" tabindex="-1"></a>tbl_sex_diagnosis <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="st">&quot;sex&quot;</span> <span class="ot">=</span> df<span class="sc">$</span>sex, <span class="st">&quot;Diagnosis&quot;</span> <span class="ot">=</span> df<span class="sc">$</span>Diagnosis)</span>
<span id="cb411-2"><a href="aggregate-data-with-tidyverse.html#cb411-2" tabindex="-1"></a>tbl_sex_diagnosis</span></code></pre></div>
<pre class="code-out"><code>   Diagnosis
sex Control  AD
  F     341 549
  M     285 318</code></pre>
<p>We can also specify names associated to the vectors/columns we use, and they will be displayed in the output. This can be usefule when dealing with two variables whose values are 0/1 or TRUE/FALSE in both.
<br>
<em>And if I want to see the fraction of females and males that are AD or Control?</em> Right, we can do it. If you try the previous approach, so dividing for the sum of the table, you will get the proportion of each category NOT divided by sex:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="aggregate-data-with-tidyverse.html#cb413-1" tabindex="-1"></a>tbl_sex_diagnosis <span class="sc">/</span> <span class="fu">sum</span>(tbl_sex_diagnosis)</span></code></pre></div>
<pre class="code-out"><code>   Diagnosis
sex   Control        AD
  F 0.2283992 0.3677160
  M 0.1908908 0.2129940</code></pre>
<p>To get what you really want, you have to use one of <code>colSums</code> or <code>rowSums</code> depending on what you want to sum. Let’s see how they work:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="aggregate-data-with-tidyverse.html#cb415-1" tabindex="-1"></a><span class="co"># 1. rowSums</span></span>
<span id="cb415-2"><a href="aggregate-data-with-tidyverse.html#cb415-2" tabindex="-1"></a>tbl_sex_diagnosis_rowsum <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(tbl_sex_diagnosis)</span>
<span id="cb415-3"><a href="aggregate-data-with-tidyverse.html#cb415-3" tabindex="-1"></a>tbl_sex_diagnosis_rowsum</span></code></pre></div>
<pre class="code-out"><code>  F   M 
890 603 </code></pre>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="aggregate-data-with-tidyverse.html#cb417-1" tabindex="-1"></a><span class="co"># 2. colSums</span></span>
<span id="cb417-2"><a href="aggregate-data-with-tidyverse.html#cb417-2" tabindex="-1"></a>tbl_sex_diagnosis_colsum <span class="ot">&lt;-</span> <span class="fu">colSums</span>(tbl_sex_diagnosis)</span>
<span id="cb417-3"><a href="aggregate-data-with-tidyverse.html#cb417-3" tabindex="-1"></a>tbl_sex_diagnosis_colsum</span></code></pre></div>
<pre class="code-out"><code>Control      AD 
    626     867 </code></pre>
<p>They perform the sum of the values in each row or the values in each column. So, we can use these values and divide our initial table to get the proportion of each sex value in each diagnosis and <em>vice versa</em>.</p>
<p><strong>Remember</strong>: when dividing a table for a vector, it performs the division in this way: each element of the first row are divided for the first element of the vector, each element of the second row for the second element of the vector and so on.</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="aggregate-data-with-tidyverse.html#cb419-1" tabindex="-1"></a>tbl_sex_diagnosis <span class="sc">/</span> tbl_sex_diagnosis_rowsum</span></code></pre></div>
<pre class="code-out"><code>   Diagnosis
sex   Control        AD
  F 0.3831461 0.6168539
  M 0.4726368 0.5273632</code></pre>
<p>We can see that ~38% of females are controls and ~62% of them have AD, while for men the proportion is quite balanced with ~47% of Control samples and ~53% of AD.
<br>
We can also check what is the proportion of males and females in each Diagnosis condition. To do so, we have to apply a little trick: in fact, we have to transpose our initial table, otherwise the division would not be applied as we want (on each level of Diagnosis), but as before (on each level of sex). We then transpose the result to obtain a table with the same orientation as the initial one.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="aggregate-data-with-tidyverse.html#cb421-1" tabindex="-1"></a><span class="fu">t</span>(<span class="fu">t</span>(tbl_sex_diagnosis) <span class="sc">/</span> tbl_sex_diagnosis_colsum)</span></code></pre></div>
<pre class="code-out"><code>   Diagnosis
sex   Control        AD
  F 0.5447284 0.6332180
  M 0.4552716 0.3667820</code></pre>
<p>And here it is: ~54% of controls and ~63% of AD are females.
<br></p>
</div>
<div id="group-by-variables-and-summarize-values-of-another" class="section level2 unnumbered">
<h2>Group by variables and summarize values of another</h2>
<p>The previous function is wonderful also to present data, but you will find yourself dealing with contingency table with more that 2 variables, so here I present you one of the greatest tool for analyzing dataframe: the magical combination of <code>group_by()</code> and <code>summarize()</code> from <em>tidyverse</em>.
Let’s see an example and then analyze how it works:</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="aggregate-data-with-tidyverse.html#cb423-1" tabindex="-1"></a><span class="co"># Suppress summarise info</span></span>
<span id="cb423-2"><a href="aggregate-data-with-tidyverse.html#cb423-2" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span>
<span id="cb423-3"><a href="aggregate-data-with-tidyverse.html#cb423-3" tabindex="-1"></a></span>
<span id="cb423-4"><a href="aggregate-data-with-tidyverse.html#cb423-4" tabindex="-1"></a><span class="co"># creating a new df with summarized counts</span></span>
<span id="cb423-5"><a href="aggregate-data-with-tidyverse.html#cb423-5" tabindex="-1"></a>df_grouped <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb423-6"><a href="aggregate-data-with-tidyverse.html#cb423-6" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, Diagnosis, dataset) <span class="sc">%&gt;%</span></span>
<span id="cb423-7"><a href="aggregate-data-with-tidyverse.html#cb423-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">counts =</span> <span class="fu">n</span>())</span>
<span id="cb423-8"><a href="aggregate-data-with-tidyverse.html#cb423-8" tabindex="-1"></a></span>
<span id="cb423-9"><a href="aggregate-data-with-tidyverse.html#cb423-9" tabindex="-1"></a>df_grouped</span></code></pre></div>
<pre class="code-out"><code># A tibble: 12 × 4
# Groups:   sex, Diagnosis [4]
   sex   Diagnosis dataset counts
   &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;int&gt;
 1 F     Control   MAYO        37
 2 F     Control   MSBB       186
 3 F     Control   ROSMAP     118
 4 F     AD        MAYO        49
 5 F     AD        MSBB       353
 6 F     AD        ROSMAP     147
 7 M     Control   MAYO        41
 8 M     Control   MSBB       170
 9 M     Control   ROSMAP      74
10 M     AD        MAYO        33
11 M     AD        MSBB       221
12 M     AD        ROSMAP      64</code></pre>
Great! We now have the number of samples for each combination of sex, Diagnosis and dataset.
<br>
<p class="plist">
It is important to understand how this code works:
</p>
<ol>
<li>
<code>options(dplyr.summarise.inform = FALSE)</code>: it is a option you can insert at the beginning of a markdown/script, after loading packages, that disable some useless messages when using summarize after group_by
</li>
<li>
<code>group_by(sex, Diagnosis, dataset)</code>: it tells dplyr (a tidyverse package) which groups are defined in this dataframe. In this case, we have 12 groups (2 sex * 2 Diagnosis * 3 dataset)
</li>
<li>
<code>summarise()</code>: takes as input a dataframe with pre-defined groups and performs action on each of them
</li>
<li>
<code>counts = n()</code>: creates a new column called counts filled by the result of function <code>n()</code>, which calculates the number of elements in each group
</li>
</ol>
<p>Wow, this is cool… but we can do more things with these functions: in fact, we can use other functions inside <code>summarize()</code> and pass a column in them; the column is divided into pre-defined group and the function is run on each of them.
<br>
For example, let’s calculate the mean and sd values of PMI for each combination of sex and Diagnosis:</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="aggregate-data-with-tidyverse.html#cb425-1" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb425-2"><a href="aggregate-data-with-tidyverse.html#cb425-2" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, Diagnosis) <span class="sc">%&gt;%</span></span>
<span id="cb425-3"><a href="aggregate-data-with-tidyverse.html#cb425-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">mean =</span> <span class="fu">mean</span>(PMI), <span class="at">sd =</span> <span class="fu">sd</span>(PMI))</span></code></pre></div>
<pre class="code-out"><code># A tibble: 4 × 5
# Groups:   sex [2]
  sex   Diagnosis     n  mean    sd
  &lt;fct&gt; &lt;fct&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
1 F     Control     341    NA    NA
2 F     AD          549    NA    NA
3 M     Control     285    NA    NA
4 M     AD          318    NA    NA</code></pre>
<p><em>Oh, what happened? Why are they all NA?</em> That’s because if a vector contains NAs, functions like mean, min, max, sd etc returns NA, unless <code>na.rm = T</code> is provided to the functions, which remove NAs from the original vector.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="aggregate-data-with-tidyverse.html#cb427-1" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb427-2"><a href="aggregate-data-with-tidyverse.html#cb427-2" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, Diagnosis) <span class="sc">%&gt;%</span></span>
<span id="cb427-3"><a href="aggregate-data-with-tidyverse.html#cb427-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">mean =</span> <span class="fu">mean</span>(PMI, <span class="at">na.rm =</span> T), <span class="at">sd =</span> <span class="fu">sd</span>(PMI, <span class="at">na.rm =</span> T))</span></code></pre></div>
<pre class="code-out"><code># A tibble: 4 × 5
# Groups:   sex [2]
  sex   Diagnosis     n  mean    sd
  &lt;fct&gt; &lt;fct&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
1 F     Control     341  7.98  5.81
2 F     AD          549  6.21  4.26
3 M     Control     285  9.68  6.99
4 M     AD          318  7.10  4.72</code></pre>
<p>Great! We can see that AD samples have a lower PMI value in both males and females. This can already be an indication that some differences are present.
<br>
I guarantee you will find yourself doing this a lot in your life.
<br>
To conclude this section, let’s use these functions to recreate the proportion table we calculate in the previous section:</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="aggregate-data-with-tidyverse.html#cb429-1" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb429-2"><a href="aggregate-data-with-tidyverse.html#cb429-2" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, Diagnosis) <span class="sc">%&gt;%</span></span>
<span id="cb429-3"><a href="aggregate-data-with-tidyverse.html#cb429-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">counts =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb429-4"><a href="aggregate-data-with-tidyverse.html#cb429-4" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb429-5"><a href="aggregate-data-with-tidyverse.html#cb429-5" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">Diagnosis =</span> Diagnosis, <span class="at">proportion =</span> counts<span class="sc">/</span><span class="fu">sum</span>(counts))</span></code></pre></div>
<pre class="code-out"><code># A tibble: 4 × 3
  sex   Diagnosis proportion
  &lt;fct&gt; &lt;fct&gt;          &lt;dbl&gt;
1 F     Control        0.383
2 F     AD             0.617
3 M     Control        0.473
4 M     AD             0.527</code></pre>
<p class="plist">
Just a couple of considerations:
</p>
<ul>
<li>
After the first summarize, we have grouped again but only by sex, to calculate the proportion of each value of Diagnosis in each sex
</li>
<li>
We used <code>reframe</code> instead of summarize just because summarize would have give a warning, but it acts the same in this scenario
</li>
<li>
We insert <code>Diagnosis = Diagnosis</code> in reframe because otherwise we would have lost this information. <strong>Remember</strong>: summarize and reframe would return only the columns of the last group_by and the ones calculated in them.
</li>
</ul>
</div>
<div id="expand-dataframe-column-using-pivot-wider" class="section level2 unnumbered">
<h2>Expand dataframe column using pivot wider</h2>
<p>Even though the previous code works fine, I know that comparing in a table-like structure is better sometimes. So here is a function that can help us in the interpretation and in the presentation of the results: <code>pivot_larger</code>.
<br>
It is easier to show than to explain:</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="aggregate-data-with-tidyverse.html#cb431-1" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb431-2"><a href="aggregate-data-with-tidyverse.html#cb431-2" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, Diagnosis) <span class="sc">%&gt;%</span></span>
<span id="cb431-3"><a href="aggregate-data-with-tidyverse.html#cb431-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">counts =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb431-4"><a href="aggregate-data-with-tidyverse.html#cb431-4" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb431-5"><a href="aggregate-data-with-tidyverse.html#cb431-5" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">Diagnosis =</span> Diagnosis, <span class="at">proportion =</span> counts<span class="sc">/</span><span class="fu">sum</span>(counts)) <span class="sc">%&gt;%</span></span>
<span id="cb431-6"><a href="aggregate-data-with-tidyverse.html#cb431-6" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> sex, <span class="at">names_from =</span> Diagnosis, <span class="at">values_from =</span> proportion)</span></code></pre></div>
<pre class="code-out"><code># A tibble: 2 × 3
  sex   Control    AD
  &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 F       0.383 0.617
2 M       0.473 0.527</code></pre>
That’s exactly the same as before!
<br>
<p class="plist">
Code explanation:
</p>
<ul>
<li>
<code>id_cols</code> is used to define the columns used as “rows”
</li>
<li>
<code>names_from</code> is used to define the columns that defines column groups
</li>
<li>
<code>values_from</code> is used to define the columns used to fill the table
</li>
</ul>
<p>Let’s see another example, because the previous one could have been written in 3 lines of code as before.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="aggregate-data-with-tidyverse.html#cb433-1" tabindex="-1"></a>df_wider <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb433-2"><a href="aggregate-data-with-tidyverse.html#cb433-2" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, Diagnosis, dataset) <span class="sc">%&gt;%</span></span>
<span id="cb433-3"><a href="aggregate-data-with-tidyverse.html#cb433-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">mean =</span> <span class="fu">mean</span>(PMI, <span class="at">na.rm =</span> T), <span class="at">sd =</span> <span class="fu">sd</span>(PMI, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb433-4"><a href="aggregate-data-with-tidyverse.html#cb433-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(sex, dataset), <span class="at">names_from =</span> Diagnosis, <span class="at">values_from =</span> <span class="fu">c</span>(mean, sd), <span class="at">names_vary =</span> <span class="st">&quot;slowest&quot;</span>)</span>
<span id="cb433-5"><a href="aggregate-data-with-tidyverse.html#cb433-5" tabindex="-1"></a></span>
<span id="cb433-6"><a href="aggregate-data-with-tidyverse.html#cb433-6" tabindex="-1"></a>df_wider</span></code></pre></div>
<pre class="code-out"><code># A tibble: 6 × 6
# Groups:   sex [2]
  sex   dataset mean_Control sd_Control mean_AD sd_AD
  &lt;fct&gt; &lt;fct&gt;          &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 F     MAYO            7          7.69    6.34  5.80
2 F     MSBB            8.60       5.79    5.76  3.91
3 F     ROSMAP          7.25       5.18    7.25  4.51
4 M     MAYO            5.51       6.42    8.6   5.83
5 M     MSBB           11.6        7.44    7.11  4.74
6 M     ROSMAP          7.34       4.05    6.58  4.24</code></pre>
<p>Super cool! In this case we used two variables to define rows and two variables to fill values.
<br></p>
</div>
<div id="reshape-a-dataframe-with-pivot_longer" class="section level2 unnumbered">
<h2>Reshape a dataframe with pivot_longer</h2>
<p>Although the previous code returns a cool table, it is suitable only to present data, not for any further analysis. As you may remember from the exercise <a href="tidyverse-manage.html#exr:read-spreadheet">12.1</a>, this is not how raw data should be organized.
<br>
If you find yourself in a situation in which raw data are like that, use <code>pivot_longer()</code> to fix it.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="aggregate-data-with-tidyverse.html#cb435-1" tabindex="-1"></a>df_wider <span class="sc">%&gt;%</span></span>
<span id="cb435-2"><a href="aggregate-data-with-tidyverse.html#cb435-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> mean_Control<span class="sc">:</span>sd_AD, <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;statistics&quot;</span>, <span class="st">&quot;Diagnosis&quot;</span>), <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>)</span></code></pre></div>
<pre class="code-out"><code># A tibble: 24 × 5
# Groups:   sex [2]
   sex   dataset statistics Diagnosis value
   &lt;fct&gt; &lt;fct&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt;
 1 F     MAYO    mean       Control    7   
 2 F     MAYO    sd         Control    7.69
 3 F     MAYO    mean       AD         6.34
 4 F     MAYO    sd         AD         5.80
 5 F     MSBB    mean       Control    8.60
 6 F     MSBB    sd         Control    5.79
 7 F     MSBB    mean       AD         5.76
 8 F     MSBB    sd         AD         3.91
 9 F     ROSMAP  mean       Control    7.25
10 F     ROSMAP  sd         Control    5.18
# ℹ 14 more rows</code></pre>
<p class="plist">
Let’s explain the code prior to adjust it a bit:
</p>
<ul>
<li>
<code>cols</code> defines which value columns to take and reshape
</li>
<li>
<code>mean_Control:sd_AD</code> means “from column mean_Control to column sd_AD”
</li>
<li>
<code>names_to</code> is used to define names for the new columns that stores the column names defined in <code>cols</code>. We set “statistics” and “Diagnosis”
</li>
<li>
<code>names_sep</code> is used when names_to has more that one value, it splits the names based on the given pattern (in our case, as the columns were like statistics_Diagnosis we used “_“)
</li>
</ul>
<p>Now, as it is a bit confusing having statistics column, we can combine the two <code>pivot_</code> functions in this way:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="aggregate-data-with-tidyverse.html#cb437-1" tabindex="-1"></a>df_wider <span class="sc">%&gt;%</span></span>
<span id="cb437-2"><a href="aggregate-data-with-tidyverse.html#cb437-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> mean_Control<span class="sc">:</span>sd_AD, <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;statistics&quot;</span>, <span class="st">&quot;Diagnosis&quot;</span>), <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb437-3"><a href="aggregate-data-with-tidyverse.html#cb437-3" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(sex, dataset, Diagnosis), <span class="at">names_from =</span> statistics, <span class="at">values_from =</span> value)</span></code></pre></div>
<pre class="code-out"><code># A tibble: 12 × 5
# Groups:   sex [2]
   sex   dataset Diagnosis  mean    sd
   &lt;fct&gt; &lt;fct&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 F     MAYO    Control    7     7.69
 2 F     MAYO    AD         6.34  5.80
 3 F     MSBB    Control    8.60  5.79
 4 F     MSBB    AD         5.76  3.91
 5 F     ROSMAP  Control    7.25  5.18
 6 F     ROSMAP  AD         7.25  4.51
 7 M     MAYO    Control    5.51  6.42
 8 M     MAYO    AD         8.6   5.83
 9 M     MSBB    Control   11.6   7.44
10 M     MSBB    AD         7.11  4.74
11 M     ROSMAP  Control    7.34  4.05
12 M     ROSMAP  AD         6.58  4.24</code></pre>
<p>Tadaaaaa!</p>
<p><br>
I think this is enough for this chapter, here are some exercise to practice these functions.</p>
</div>
<div id="exercises-7" class="section level2 unnumbered">
<h2>Exercises</h2>
<div class="exercise">
<p><span id="exr:aggr-multi" class="exercise"><strong>Exercise 13.1  </strong></span>This is a multi-question exercise, that resemble a real-life analysis.</p>
<p class="plist">
Considering our initial dataframe:
</p>
<ol>
<li>
Are there differences between datasets in RIN value? consider max, min and mean
</li>
<li>
Which Area has the highest value of AOD? And, is there difference between sex in these values?
</li>
<li>
How many NAs are present in CDR for each combination of Diagnosis and dataset?
</li>
<li>
Sort the dataframe based on the average vale of PMI for each area, based also on sex
</li>
</ol>
</div>
<details>
<summary>
Solution
</summary>
<p>We will answer one question at a time.
<br></p>
<p><strong>1.</strong></p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="aggregate-data-with-tidyverse.html#cb439-1" tabindex="-1"></a><span class="co"># 1. Calculate mean, min and max values of RIN for each dataset</span></span>
<span id="cb439-2"><a href="aggregate-data-with-tidyverse.html#cb439-2" tabindex="-1"></a>df_RIN_dataset <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb439-3"><a href="aggregate-data-with-tidyverse.html#cb439-3" tabindex="-1"></a>  <span class="fu">group_by</span>(dataset) <span class="sc">%&gt;%</span></span>
<span id="cb439-4"><a href="aggregate-data-with-tidyverse.html#cb439-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">min =</span> <span class="fu">min</span>(RIN, <span class="at">na.rm =</span> T), <span class="at">mean =</span> <span class="fu">mean</span>(RIN, <span class="at">na.rm =</span> T), <span class="at">max =</span> <span class="fu">max</span>(RIN, <span class="at">na.rm =</span> T))</span>
<span id="cb439-5"><a href="aggregate-data-with-tidyverse.html#cb439-5" tabindex="-1"></a>  </span>
<span id="cb439-6"><a href="aggregate-data-with-tidyverse.html#cb439-6" tabindex="-1"></a>df_RIN_dataset</span></code></pre></div>
<pre class="code-out"><code># A tibble: 3 × 4
  dataset   min  mean   max
  &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 MAYO      5.3  8.11  10  
2 MSBB      1    6.23  10  
3 ROSMAP    5    7.11   9.9</code></pre>
<p><em>Yes, it seems that MAYO dataset is the one with better RIN values, while MSBB has the worst samples.</em></p>
<p><strong>2.</strong></p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="aggregate-data-with-tidyverse.html#cb441-1" tabindex="-1"></a><span class="co"># 1. Calculate max value of AOD for each dataset</span></span>
<span id="cb441-2"><a href="aggregate-data-with-tidyverse.html#cb441-2" tabindex="-1"></a>df_AOD_dataset <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb441-3"><a href="aggregate-data-with-tidyverse.html#cb441-3" tabindex="-1"></a>  <span class="fu">group_by</span>(dataset, sex) <span class="sc">%&gt;%</span></span>
<span id="cb441-4"><a href="aggregate-data-with-tidyverse.html#cb441-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">max_AOD =</span> <span class="fu">max</span>(AOD, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb441-5"><a href="aggregate-data-with-tidyverse.html#cb441-5" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> dataset, <span class="at">names_from =</span> sex, <span class="at">values_from =</span> max_AOD)</span>
<span id="cb441-6"><a href="aggregate-data-with-tidyverse.html#cb441-6" tabindex="-1"></a></span>
<span id="cb441-7"><a href="aggregate-data-with-tidyverse.html#cb441-7" tabindex="-1"></a>df_AOD_dataset</span></code></pre></div>
<pre class="code-out"><code># A tibble: 3 × 3
# Groups:   dataset [3]
  dataset     F     M
  &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 MAYO       90    90
2 MSBB       90    90
3 ROSMAP     90    90</code></pre>
<p><em>No, there is not difference between dataset, even considering sex.</em></p>
<p><strong>3.</strong></p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="aggregate-data-with-tidyverse.html#cb443-1" tabindex="-1"></a><span class="co"># 1. Calculate number of CDR NAs for each Diagnosis/dataset combination</span></span>
<span id="cb443-2"><a href="aggregate-data-with-tidyverse.html#cb443-2" tabindex="-1"></a>df_nas_diag_dataset <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb443-3"><a href="aggregate-data-with-tidyverse.html#cb443-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Diagnosis, dataset) <span class="sc">%&gt;%</span></span>
<span id="cb443-4"><a href="aggregate-data-with-tidyverse.html#cb443-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_nas =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(CDR))) <span class="sc">%&gt;%</span></span>
<span id="cb443-5"><a href="aggregate-data-with-tidyverse.html#cb443-5" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> Diagnosis, <span class="at">names_from =</span> dataset, <span class="at">values_from =</span> n_nas)</span>
<span id="cb443-6"><a href="aggregate-data-with-tidyverse.html#cb443-6" tabindex="-1"></a></span>
<span id="cb443-7"><a href="aggregate-data-with-tidyverse.html#cb443-7" tabindex="-1"></a>df_nas_diag_dataset</span></code></pre></div>
<pre class="code-out"><code># A tibble: 2 × 4
# Groups:   Diagnosis [2]
  Diagnosis  MAYO  MSBB ROSMAP
  &lt;fct&gt;     &lt;int&gt; &lt;int&gt;  &lt;int&gt;
1 Control      78     0    192
2 AD           82     0    211</code></pre>
<p><em>It seems that people that have filled MSBB dataset have done a better job in collecting data than the others ahahah</em></p>
<p><strong>Remember</strong>: <code>is.na()</code> returns a boolean vector, and the sum of a boolean vector is the number of TRUE values in it.</p>
<p><strong>4.</strong></p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="aggregate-data-with-tidyverse.html#cb445-1" tabindex="-1"></a><span class="co"># 1. Sort dataframe based on mean PMI value for each Area/sex</span></span>
<span id="cb445-2"><a href="aggregate-data-with-tidyverse.html#cb445-2" tabindex="-1"></a>df_PMI_area_sex <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb445-3"><a href="aggregate-data-with-tidyverse.html#cb445-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Area, sex) <span class="sc">%&gt;%</span></span>
<span id="cb445-4"><a href="aggregate-data-with-tidyverse.html#cb445-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_PMI =</span> <span class="fu">mean</span>(PMI, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb445-5"><a href="aggregate-data-with-tidyverse.html#cb445-5" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_PMI))</span>
<span id="cb445-6"><a href="aggregate-data-with-tidyverse.html#cb445-6" tabindex="-1"></a></span>
<span id="cb445-7"><a href="aggregate-data-with-tidyverse.html#cb445-7" tabindex="-1"></a>df_PMI_area_sex</span></code></pre></div>
<pre class="code-out"><code># A tibble: 12 × 3
# Groups:   Area [6]
   Area  sex   avg_PMI
   &lt;fct&gt; &lt;fct&gt;   &lt;dbl&gt;
 1 BM44  M        9.25
 2 BM36  M        9.16
 3 BM10  M        9.11
 4 BM22  M        8.69
 5 DLPFC F        7.25
 6 BM10  F        7.02
 7 DLPFC M        6.99
 8 BM36  F        6.70
 9 TL    F        6.66
10 TL    M        6.64
11 BM22  F        6.64
12 BM44  F        6.60</code></pre>
<p><em>Males BM44 samples have the higher mean of PMI.</em></p>
</details>
<p>I’m so proud of you to have reached this chapter. What’s next? Plotting! Data should be visualized for a better understand of them.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tidyverse-manage.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="plot-our-data-with-ggplot2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
